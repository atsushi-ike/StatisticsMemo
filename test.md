# ピアソンの相関係数について

## 概要

ピアソンの相関係数（Pearson correlation coefficient）は、**2つの変数の線形的な関係性の強さと向き**を測定する指標です。  
相関係数は **-1から1の範囲**をとり、

- `+1`: 完全な正の相関（Xが増えるとYも増える）
- `0`: 相関なし（線形関係がない）
- `-1`: 完全な負の相関（Xが増えるとYは減る）

を意味します。

## 概念

ピアソンの相関係数は、**標準化されたXと標準化されたYの共分散**です。  
すなわち、以下のように定義されます：

> **相関係数 = 標準化したXと標準化したYの共分散**

標準化とは、各変数から平均を引き、標準偏差で割る操作のことです。  
これにより、平均0・分散1の変数に変換され、共通のスケールで比較可能になります。

---

## 公式

2変数 $X = (x_1, x_2, ..., x_n)$、 $Y = (y_1, y_2, ..., y_n)$ のピアソン相関係数 $r$ は以下の式で定義されます：

$$
r = \frac{\sum_{i=1}^{n}(x_i - \bar{x})(y_i - \bar{y})}{\sqrt{\sum_{i=1}^{n}(x_i - \bar{x})^2} \cdot \sqrt{\sum_{i=1}^{n}(y_i - \bar{y})^2}}
$$

または、標準化後の変数 $Z_X, Z_Y$ を使って：

$$
r = \frac{1}{n-1} \sum_{i=1}^{n} z_{x_i} \cdot z_{y_i}
$$

---

## 検定（有意性の検定）

相関係数が偶然得られたものではなく、**統計的に有意かどうか**を検定するために、以下の t 検定が用いられます。

### 帰無仮説 $H_0$ :

$$
\rho = 0 \quad (\text{母集団の相関係数は0である})
$$

### 対立仮説 $H_1$ :

$$
\rho \neq 0 \quad (\text{母集団の相関係数は0でない})
$$

### 検定統計量:

$$
t = \frac{r \sqrt{n - 2}}{\sqrt{1 - r^2}} \quad \text{（自由度 } n - 2 \text{）}
$$

得られた t 値に基づいて、t 分布を使って p 値を計算します。  
一般的には有意水準 $\alpha = 0.05$ などで有意かどうかを判断します。

---

## 信頼区間

ピアソンの相関係数の信頼区間を求めるには、**Fisherのz変換**を用います。

### 手順：

1. 相関係数 $r$ を Fisherのz値 に変換：

$$
z = \frac{1}{2} \ln\left(\frac{1 + r}{1 - r}\right)
$$

2. $z$の標準誤差：

$$
SE_z = \frac{1}{\sqrt{n - 3}}
$$

3. $z$の信頼区間（95%信頼区間など）：

$$
z_{\text{lower}} = z - 1.96 \cdot SE_z \\
z_{\text{upper}} = z + 1.96 \cdot SE_z
$$

4. zの信頼区間を相関係数 $r$ の信頼区間に逆変換：

$$
r_{\text{lower}} = \frac{e^{2z_{\text{lower}}} - 1}{e^{2z_{\text{lower}}} + 1} \\
r_{\text{upper}} = \frac{e^{2z_{\text{upper}}} - 1}{e^{2z_{\text{upper}}} + 1}
$$

---

## まとめ

| 項目       | 内容                                           |
|------------|------------------------------------------------|
| 定義       | 標準化したXとYの共分散                        |
| 範囲       | -1 〜 +1                                       |
| 検定方法   | t検定を用いて有意性を評価                      |
| 信頼区間   | Fisherのz変換を用いて計算                      |
